## 1. 렌더링 플로우 개요

### 렌더링이란?
React에서 "렌더링"은 컴포넌트의 상태(state)나 props가 변경될 때 UI를 다시 그려주는 과정을 의미한다. 이 과정은 다음과 같은 단계로 이루어진다:

1. 상태(state)나 props 변경 발생
2. React가 새로운 Virtual DOM(VDOM) 트리를 생성
3. 이전 VDOM과 비교(diffing)를 통해 변화 감지
4. 실제 DOM에 최소한의 변경만 적용 (commit phase)

### Render Phase vs Commit Phase

- **Render Phase**: 변경된 상태를 기반으로 새로운 VDOM 생성 및 변경 사항 계산
- **Commit Phase**: 실제 DOM 업데이트, `ref` 연결, 라이프사이클 메서드(`componentDidMount`, `useEffect`) 실행 등 수행

> React는 이 두 단계로 나누어 효율적인 렌더링과 최적화를 도모한다.

---

## 2. Virtual DOM & Diffing

### Virtual DOM이란?
Virtual DOM은 React가 내부적으로 사용하는 메모리 상의 UI 트리 구조이다. 브라우저의 실제 DOM 조작은 비용이 높기 때문에, React는 Virtual DOM을 통해 상태 변화 시 필요한 변경만 찾아 실제 DOM에 최소 반영한다.

```tsx
const element = <div>Hello</div>;
```

실제 메모리 상에선 아래처럼 객체로 표현된다:

```js
{
  type: 'div',
  props: {
    children: 'Hello'
  }
}
```

### Virtual DOM vs 실제 DOM

| 항목 | Virtual DOM | 실제 DOM |
|------|-------------|-----------|
| 위치 | 메모리 상 | 브라우저 내부 |
| 접근 속도 | 빠름 | 느림 |
| 조작 방식 | 일괄 변경 (diff 후) | 직접 조작 |
| 비용 | 낮음 | 높음 |

### Diffing 알고리즘 (Reconciliation)
React는 변화 전후 두 개의 VDOM을 비교(diff)하여 변화된 부분만 찾아내고 실제 DOM에 반영한다. 이 과정을 **Reconciliation**이라고 한다.

#### 비교 규칙
1. **다른 타입의 엘리먼트**: 전체 교체
2. **key가 다른 엘리먼트**: 해당 요소 및 자식 전체 재생성
3. **동일한 타입 + key**: props 변경만 반영

이 규칙 덕분에 트리 전체를 비교하지 않고도 효율적인 업데이트가 가능하다. 복잡도는 O(n) 수준으로 최적화되어 있다.

### 왜 Virtual DOM이 필요한가?
- 브라우저 DOM은 느리므로 최소 접근이 중요함
- React는 상태 변화가 많기 때문에 중간 단계(VDOM)를 거쳐서 배치(Batching) 처리함
- React Native, Server Components 등 다양한 환경에서도 일관된 렌더링 구조 제공 가능

---

## 3. Fiber 구조

### Fiber란?
React 16부터 도입된 새로운 렌더링 엔진으로, 기존의 stack-based 렌더링 한계를 극복하기 위해 등장했다. Fiber는 렌더링 단위를 '작게 쪼개서' 수행함으로써 더 부드러운 사용자 경험을 제공한다.

### 기존 렌더링 방식의 문제점
- 모든 컴포넌트 렌더링이 한 번에 동기적으로 수행됨
- 작업이 길어지면 브라우저 이벤트 처리나 애니메이션 응답이 늦어짐
- 스크롤 멈춤, 프레임 드랍 등의 문제 발생 가능

### Fiber의 도입으로 가능한 것들
- **렌더링 작업 중단 가능**
- **중단된 지점부터 재개 가능**
- **우선순위 기반 처리 (e.g. 사용자 입력 먼저 처리)**
- **타임 슬라이싱(Time Slicing)으로 프레임 유지율 향상**

### Fiber 구조 내부
Fiber는 Virtual DOM과 유사하지만 더 많은 정보를 포함한다:

- `type`: 컴포넌트 타입
- `key`: 엘리먼트 식별용
- `props`: 현재 props
- `stateNode`: 해당 컴포넌트 인스턴스 or DOM 노드
- `return`, `child`, `sibling`: 부모-자식 관계
- `alternate`: 이전 렌더링 결과 (Double Buffering)

이 구조 덕분에 현재 작업 중인 트리와 이전 트리를 병렬로 유지하며 렌더링 흐름을 세밀하게 제어할 수 있다.

### Fiber의 장점
- 작업 분할 및 중단/재개 가능 → 메인 스레드 점유 최소화
- 우선순위 스케줄링 → UX 향상 (e.g. 키 입력 응답 빠르게)
- 향후 기능 (e.g. Concurrent Mode, Suspense, Transition 등) 지원 기반

### Fiber의 단점
- 구조 복잡도 상승
- 디버깅 난이도 상승 (DevTools로도 완전히 추적하기 어려움)

### 확인 방법
React DevTools에서 컴포넌트 하나하나가 Fiber 단위로 트리화되어 있는 것을 볼 수 있다. 특히 Profiler 탭을 통해 렌더링 시간, 작업 중단 여부 등을 시각적으로 확인할 수 있다.

